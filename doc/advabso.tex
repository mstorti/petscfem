%__INSERT_LICENSE__
% $Id: advabso.tex,v 1.4 2005/02/09 01:45:13 mstorti Exp $ 

\SSection{Absorbing boundary conditions} 

Absorbing boundary conditions are a very useful feature for the
solution of advective diffusion problems. They allow the user to put
artificial boundaries closer to the interest region, and also
accelerate convergence to steady solutions, since provide the highest
rate of energy dissipation through the boundaries. 

In PETSc-FEM, once you write the flux function for a particular
advective-diffusive problem you get absorbing boundary conditions with
none or little extra wotk. There are basically two types of absorbing
boundary conditions

\begin{itemize}
\compactlist 
\item Linear, based on the Jacobian of the flux function, assuming
  small perturbations about a reference value. 
\item Based on Riemman invariants (require the writter of the flux
  function to provide the Riemman invariants for the flux
  function). (Needs the user to write the Riemman invariants and 
\end{itemize}

%<*>---<*>---<*>---<*>---<*>---<*>---<*>---<*>---<*>---<*>---<*>
\SSSection{Linear perturbation theory of absorbing boundary conditions} 
 
Starting with the conservation form of an advective system
(\ref{eq:advec-eq}), and assuming small perturbations about a mean
fluid state $!U(!x,t) = !U_0 + !U'(!x,t)$, and no source term, then we
obtain the linearized form
%
\begin{equation} \label{eq:advec-lin}  
  \dep{!U'}t + !A_0\dep {!U'}x =0. 
\end{equation}
%
where we assume further, that the flow only depends on $x$ the
direction normal to the boundary. Let $!S$ be the matrix of
right eigenvectors of $!A_0$ so that
%
\begin{equation} 
  !A_0!S = !S\Lambda
\end{equation}
%
where $\bzL = \diag\{\lambda_1,...,\lambda_\ndof\}$ are the
eigenvalues of $A_0$. Multiplying (\ref{eq:advec-lin}) at left byt
$!S\muno$ and defining $V=!S\muno !U'$ we obtain a decoupled system of
equations
%
\begin{equation}
  \dep{!V}t + \bzL\dep {!V}x =0. 
\end{equation}
%
Now, the equation for each component $v_j$ of $!V$ is a simple linear
transport equation with constant transport velocity $\lambda_j$
%
\begin{equation}
  \dep{v_j}t + \lambda_j\dep {v_j}x =0. 
\end{equation}
%
so that the absorbing boundary condition is almost evident. Assuming
that we want to solve the equation on $-\infty<x<0$, so that $x=0$ is
a boundary, then the corresponding absorbing boundary condition is
%
\begin{equation} \label{eq:v-abc}  
  \begin{cases}
    v_j(0) = 0; & \text{ if $\lambda_j\le 0$ (ingoing boundary)}\\
    v_j \textrm{extrapolated from interior}; & \text{(outgoing boundary)}\\
  \end{cases}
\end{equation}
%
This can be summarized as
%
\begin{equation} 
  \bzP_V^- !V_0 = 0
\end{equation}
%
where 
%
\begin{equation} 
  \bzP_V^- = \diag\{(1-\sign(\lambda_j))/2\}
\end{equation}
%
is the projection matrix onto the space of incoming waves. As the
$\bzP_V^-$ is a diagonal matrix, with diagonal elements 1 or 0, it
trivially satisfies the projection condition $\bzP_V^- \bzP_V^- =
\bzP_V^-$. 

Coming back to the $!U$ basis, we obtain the following first-order,
linear absorbing boundary condition
%
\begin{equation} \label{eq:lin-abc}  
  \bzP_U^-(!U_0) \, (!U(x=0)-!U_0) = 0. 
\end{equation}
%
This condition is perfectly absorbing for small amplitude waves around
the state $!U_0$. The main problem with it is that, as the limit state
at the boundary $!U_\infty$ is not known a priori, we have to use some
\emph{a priori} chosen state $!U_0\neq !U_\infty$ and then, the
projection matrix used $\bzP_U^-(!U^0)$ will not be equal to
$\bzP_U^-(!U_\infty)$, and then not fully absorbing.  We call $!U_0$
the reference state for the absorbing boundary condition. It can
even happen that the eigenvalues for the actual state at the boundary
change sign with respect to the reference state. 

%<*>---<*>---<*>---<*>---<*>---<*>---<*>---<*>---<*>---<*>---<*> 
\SSSection{Riemman based absorbing boundary conditions} 

Let $n^-$ ($n^+)$ be the number of incoming (outgoing) waves, i.e. the
number of negative (positive) eigenvalues of $A_0$, and assume that
the eigenvalues are ordered, i,e, $\lambda_j\le\lambda_k$, if
$j<k$. So that the negative eigenvalues are the first $n^-$ ones. The
boundary conditions for the incoming waves (\ref{eq:v-abc}) can be
written as
%
\begin{equation} \label{eq:l-abc}  
  !l_j.(!U-!U_0) = 0, \ \ \ j=1,\dots,n^-
\end{equation}
%
where $!l_j$ is a row of $!S\muno$, i.e. a \emph{``left eigenvalue''}
of $!A_0$. If $!U$ is close to $!U_0$ we can write (\ref{eq:l-abc}) as 
%
\begin{equation} \label{eq:abc-ri-dif}  
  !l_j(!U).\di!U = 0, \ \ \ j=1,\dots,n^-.
\end{equation}
%
If this differential form were an \emph{``exact differential''},
i.e. if 
%
\begin{equation} \label{eq:abc-ri-def}   
  !l_j(!U).\di!U = \di w_j(!U)
\end{equation}
%
for some function $w_j(!U)$, then we could impose as absorbing
boundary condition 
%
\begin{equation} \label{eq:ri-abc}  
  w_j(!U) = w_j(!U_0), \ \ \ j=1,\dots,n^-. 
\end{equation}
%
Assume that the value at the boundary reaches a steady limit value of
$!U_\infty$, i.e.
%
\begin{equation} 
!U(x=0,t)\to!U_\infty,  \text{ for } \ \ \ t\to\infty
\end{equation}
%
If all the waves were incoming ($n^-=\ndof$), then the set of boundary
conditions (\ref{eq:ri-abc}) would be a set of $\ndof$ non-linear
equations on the value $!U_\infty$. If the correspondence $!U\to!w$ is
one to one, the boundary conditions would mean $!w(!U_\infty) =
!w(!U_0)$, and then $!U_\infty=!U_0$. But if the number of incoming
waves is $n^-<\ndof$, then it could happen that $!U_\infty\neq
!U_0$. In fact, for a given $U_0$, the limit value $!U_\infty$ would
belong to a curved $n^+$-dimensional curvilinear manifold. Even if the
limit state $!U_\infty!=!U_0$, we can proved to be perfectly
absorbing, since, as $!U\to!U_\infty$ at the boundary, we can expand
each of the conditions around $!U_\infty$ and ot would result in an
equation similar to (\ref{eq:abc-ri-dif}) but centered about
$!U_\infty$, 
%
\begin{equation}
  !l_j(!U_\infty).(!U-!U_\infty) = 0, \ \ \ j=1,\dots,n^-.
\end{equation}

The problem is that in general the differentials are not
exact. \emph{``Riemman invariants''} are functions that satisfy
(\ref{eq:abc-ri-def}) under some restrictions on the flow. For
instance, Riemman invariants invariants can be computed for
compressible gas flow if we assume that the flow is isentropic. They
are
%
\begin{equation} 
  \begin{aligned} 
    w_1 &= s = \log (p/\rho^\gamma), & \lambda_1&=u, & &\text{(entropy)}; \\
    w_{2,3} &= u\pm\frac{2a}{\gamma-1}, & \lambda_{2,3}&=u\pm a, &
    &\text{(acoustic waves)};\\
    w_{4,5} &= !u\cdot{\versor t}_{1,2};  & \lambda_{4,5}&=u, &
    &\text{(vorticity waves)}.\\
  \end{aligned}
\end{equation}

Boundary conditions based on Riemman invariants are, then, absorbing
in some particular cases. 

%<*>---<*>---<*>---<*>---<*>---<*>---<*>---<*>---<*>---<*>---<*> 
\SSSection{Absorbing boundary conditions based on last state} 

Another possibility is to linearize around the last state $!U^n$, i.e.
%
\begin{equation} \label{eq:lin-abc-n}  
  \bzP_U^-(!U(0,t^n)) \, (!U(0,t^{n+1})-!U(0,t^n)) = 0. 
\end{equation}
%
This equation is always perfectly absorbing in the limit, because we
are always linearizing about a state that, in the limit, will tend to
$!U_\infty$ and doesn't need the computation of Riemman invariants
(which could be unknown for certain problems). Also, this boundary
condition is fully absorbing even in the case of inversion of the
sense of propagation of waves. 

The drawback is that we have no external control on the internal
states, i.e. the limit internal state does not depend on some external
value (as the $!U_0$ used for the Riemman based absorbing boundary
conditions), but on the internal state. That means, for instance, that
if the internal computational scheme tends to produce some error (due
to non conservativity, or rounding errors), the internal state would
drift constantly.

One possibility is to use Riemann based or simple linear absorbing
boundary conditions (\ref{eq:lin-abc}) at inlet and absorbing boundary
conditions based on last state (\ref{eq:lin-abc-n}) at outlet. As the
error tends to propagate more intensely towards the outlet boundary,
it is preferably to use strongly absorbing boundary conditions there,
whereas the linearly absorbing or Riemman invarinat boundary
conditions upstream avoid the drift. 

% Local Variables: *
% mode: latex *
% latex-occur-section-regexp: "^\\\\S*ection" *
% tex-main-file: "petscfem.tex" *
% End: *
