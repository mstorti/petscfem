%__INSERT_LICENSE__
\Section{Hooks}

Hooks are functions that you pass to the program and, then, are
executed at particular points in the execution of the program. The
particular hooks may depend on the application but, in order to fix
ideas, for the Navier-Stokes module and the Advective-Diffusive
module the standard hooks are: 
%
\begin{itemize}
\item{\tt init:} To be executed once, at the start of the program. 
\item{\tt time\_step\_pre:} To be executed before the time step
calculation. 
\item{\tt time\_step\_post:} To be executed after the time step
calculation. 
\item{\tt close:} To be executed once, at the end of the program. 
\end{itemize}
%
There are \emph{``built-in''} hooks included in the modules, for
instance the DX hook that is in charge of communicating with the DX
visualizations program or the \emph{``shell-hook''} that allows you to
execute shell commands, but you can also define your own hooks that
are defined in a C++ piece of code, compiled and dynamically loaded at
run-time. You can do almost anything with your hooks, for instance you
can compress the result files, perform file manipulation, launch
visualization with other software like GMV. Also, hooks are useful
for communicating between different instances of PETSc-FEM. For
instance, if you want to couple a inviscid external flow with an
internal viscous flow, then you can run a PETSc-FEM instance for each
region and perform the communication between the different regions
with hooks. 

\SSection{Dynamically loaded hooks} 

The most easy way to define a dynamically loadable hook is through a
class. You need to include the corresponding headers {\tt hook.h} and
{\tt dlhook.h}, and the class may have all, some or none of the
previous four hook functions defined. Consider for instance the
following ``Hello world!'' hook, that prints the message at the
corresponding points in the program. 

\begin{verbatim}
#include <src/hook.h>
#include <src/dlhook.h>

class hello_world_hook {
public:
  void init(Mesh &mesh_a,Dofmap &dofmap,
	    TextHashTableFilter *options,const char *name) {
    printf("Hello world! I'm in the \"init\" hook\n");
  }
  void time_step_pre(double time,int step) {
    printf("Hello world! I'm in the \"time_step_pre\" hook\n");
  }
  void time_step_post(double time,int step,
		      const vector<double> &gather_values) {
    printf("Hello world! I'm in the \"time_step_post\" hook\n");
  }
  void close() {
    printf("Hello world! I'm in the \"close\" hook\n");
  }
};

DL_GENERIC_HOOK(hello_world_hook);
\end{verbatim}

You can use almost any conceivable C/C++ library within your hooks. Take
into acount that the program may be called in a parallel environment,
for instance, if you will compress a certain file, then you should 



% Local Variables: *
% mode: latex *
% tex-main-file: "petscfem.tex" *
% End: *

