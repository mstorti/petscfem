# -*- mode: makefile -*-
#__INSERT_LICENSE__
LAPLACE = $(PETSCFEM_DIR)/applications/laplace/laplace.bin
NS    = $(PETSCFEM_DIR)/applications/ns/ns.bin
NS_STBL    = $(PETSCFEM_DIR)/../petscfem/applications/ns/ns.bin
ADV    = $(PETSCFEM_DIR)/applications/advective/adv.bin
ADVDIF = $(PETSCFEM_DIR)/applications/advdif/advdif.bin

SRCS = $(wildcard *.cpp)

#----<*>----------<*>----------<*>----------<*>----------<*>----------<*>-----
# Shortcuts to programs
ns: $(NS)
adv: $(ADV)
laplace: $(LAPLACE)

$(NS): force
	$(MAKE) -C $(PETSCFEM_DIR) ns

$(ADV): force
	$(MAKE) -C $(PETSCFEM_DIR) adv

$(LAPLACE): force
	$(MAKE) -C $(PETSCFEM_DIR) laplace

$(ADVDIF): force
	$(MAKE) -C $(PETSCFEM_DIR) advdif

local_clean::
	-rm -f *.o *.sal tmp_file_*.tmp *.bin *~ *.tmp \
		machi.dat weights.dat rm *.depl .gdbinit

SRC_DIR = $(PETSCFEM_DIR)/src
LIB := $(SRC_DIR)/libpetscfem_$(opt_level).a
LIB_OBJS_LIB := $(patsubst %,$(LIB)(%.o),$(LIB_OBJS))

$(LIB)(%.o):
	$(MAKE) -C $(SRC_DIR) 'libpetscfem_$(opt_level).a($*.o)'

#	-chmod +w *.depl ; 
#	for dir in $(CLEAN_DIRS) ; \
#		do $(MAKE) -C $$dir lclean ;\
#	done
