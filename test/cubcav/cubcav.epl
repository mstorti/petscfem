# -*- mode: shell-script -*-
<:                              # starts ePerl block
#__TRANSCRIPT__
require "$ENV{'PETSCFEM_DIR'}/test/eperlini.pl";# Initializes ePerl 
$case = 'laplace' unless $case;
get_var_env2('NP',undef);
$CASE = $case;
$N = 20 unless defined $N;
$hratio = 1;
$use_tetra = 1;
$maxits = 600;
$tol = 1e-7;
get_var_env2('subpart',20);
$iisd_subpart = $subpart;
get_var_env2('nlay',1);
get_var_env2('isp_maxits',10);
#
#__END_TRANSCRIPT__
transcript("", qw(viscosity Dt));	# print variables on output
octave_export_vars(">data.m.tmp",qw(CASE U L N Re viscosity 
    h Co Dt hratio leaky tol use_prismatic use_tetra));
system "octave -qH mkmesh.m > mkmesh.output.tmp";
:>//                            # ends ePerl block

global_options

# <:pr('dx'):>
# <:pr('case'):>
# <:pr('subpart'):>
# <:pr('nlay'):>
ndim 3
nsave 3
nstep 4
# initial_state cubcav.state
save_file_pattern "outvector%d.out.tmp"

compact_profile_graph_chunk_size <:=$graph_chunk_size:>
preco_type "jacobi"
chunk_size 1000
#if $iisd_subpart
solver "iisd"
<:pr('iisd_subpart'):>
use_interface_full_preco 1
use_interface_full_preco_nlay <:=$nlay:>
print_interface_full_preco_conv 0
interface_full_preco_maxits <:=$isp_maxits:>
interface_full_preco_relax_factor 0.5
#else
solver "petsc"
#endif
Krylov_dim <:=$maxits:>
<:pr('maxits'):>
report_consumed_time
#
activate_debug_print
activate_debug_memory_usage
# activate_debug

iisdmat_print_statistics
print_partitioning_statistics

# file containing the weight (speed) of processors
proc_weights weights.dat
max_partgraph_vertices 4000
max_partgraph_vertices_proc 4000

#    Iterative parameters
tol_tet 1e-5
tol_newton -1.
atol 0
rtol 1e-8
dtol 1e3
nnwt 1

print_internal_loop_conv 1
# print_linear_system_and_stop 1
# solve_system 0
#verify_jacobian_with_numerical_one 1

rho 1
viscosity 0.001
Dt 1
steady 1
temporal_stability_factor 0

#if $dx
hook_list ns_dx_hook my_dx_hook
dx_split_state "1 3 0 1 2 u 1 1 3 p"
dx_auto_combine
dx_state_all_fields 0
dx_steps 1
dx_read_state_from_file
#endif

__END_HASH__

# ndim nu ndof
nodedata  3  3  4
data cubcav.nod.tmp
__END_HASH__

elemset nsi_tet_les_fm2 4
name fluid
geometry tetra
npg 4
data cubcav.con-tetra.tmp
dx 1
__END_HASH__

end_elemsets

fixa
# fijaciones de velocidad en las paredes
__INCLUDE__ cubcav.fixa.tmp
# fijacion en la presion
1 4 0.
__END_FIXA__
