# -*- mode: shell-script -*-
#
<:require '../../eperlini.pl':>// # Initializes ePerl 
# ---- <>  ---- <>  ---- <>  ---- <>  ---- <>  ---- <>  ---- <>

<: 
#__TRANSCRIPT__
$Ly=readm("Ly","mkmesh.m");	# Plate separation
$Re_laminar=1;			# Reynolds number
$u_max=1;			# Average velocity
$u_av = (2/3)*$u_max;		# Average velocity
$nu=$u_av * $Ly / $Re_laminar;	# Kinematic viscosity 
$dpdx=8*$nu*$u_max/$Ly**2;	# Longitudinal pressure gradient 
#__END_TRANSCRIPT__
transcript();
doc_vals(qw(Ly Re_laminar u_max u_av nu dpdx));
:>//

global_options

nsave 100
#save_file_pattern stabi.state.%d.tmp
nsaverot 50
nfile 2
nrec 20
save_file stabi.state.tmp
nstep 1
#report_consumed_time 1
chunk_size 2000
proc_weights weights.dat
temporal_stability_factor 1 # for compatibility with older versions

#    Iterative parameters
#update_jacobian_iters 1
nnwt 1
maxits 20
Krylov_dim 20

Dt 100.
alpha 1.
LES 0
G_body <:=$dpdx:> 0. 0.
verify_jacobian_with_numerical_one 0
#if $stabi
initial_state "stabi.state.tmp"
print_linear_system_and_stop
#endif
preco_type "lu"

#tau_fac 1.
shock_capturing_factor 0
print_internal_loop_conv 0
# Datos fisicos
#
viscosity <:=$nu:>
weak_form 0
__END_HASH__

#================================================================
# ndim nu ndof
nodes  2  2  3
__INCLUDE__ stabi.nod.tmp
_END_NODES__

#================================================================
elemset nsi_tet_les_fm2 4
props 
name malla
geometry cartesian2d
ndim 2
npg 4
__END_HASH__
__INCLUDE__ stabi.con.tmp
__END_ELEMSET__

#================================================================
fixa
__INCLUDE__ stabi.fixaw.tmp
# Fix pressure at some node 
1 3 0.
__END_FIXA__

#================================================================
constraint
__INCLUDE__ stabi.peri.tmp
__END_CONSTRAINT__

