<:                              # starts ePerl block
#__TRANSCRIPT__
require "$ENV{'PETSCFEM_DIR'}/test/eperlini.pl";       # Initializes ePerl 
require "$ENV{'PETSCFEM_DIR'}/tools/dx.pl";       # Initializes ePerl 
$case_name = $ENV{'case_name'};
$case_name = 'default' unless defined $case_name;
$Re = 100;
$Co = 2;

if (0) {   ## large mesh
    $Rint=1;
    $Rext=4;
    $L = 8;
    $Ntheta = 80;
    $Nr=40;
    $Nx=80;
    $du_ini_pert = 0.3;
} else {  ## small mesh, small domain
    $Rint=1;
    $Rext=2;
    $L = 6;
    $Ntheta = 40;
    $Nr=20;
    $Nx=40;
    $du_ini_pert = 0.3;
}
$Rext2=2*$Rext;
$Next = $Nr/2;
$hmin = 2*$PI*$Rint/$Ntheta;
#__END_TRANSCRIPT__
@vars = qw(Rint Rext Rext2 L Ntheta Nr Nx du_ini_pert Next);
transcript("", @vars);	# print variables on output and transcript this block
octave_export_vars(">data.m.tmp",@vars);
system "octave -qH cylin.m";
$nnod = count_lines("./cylin.nod.tmp");
:>//                            # ends ePerl block

# <:pr('case_name'):>
#===========================================================
global_options
ndim 2
save_file "cylin.state.tmp"
save_file_pattern "outvector.out.tmp"
nsave 10
nsaverot 10
# initial_state "cylin.state.tmp"
initial_state "cylin.ini.tmp"
nstep 1000
# steady
solver "iisd"
iisd_subpart_auto 2000
print_internal_loop_conv 1
Krylov_dim 200
nnwt 2
alpha 0.6
weak_form 0
Dt <:=$Co*$hmin:>
rtol 1e-4
atol 1e-10
iisdmat_print_statistics
print_partitioning_statistics
hook_list dl_generic_hook coupling_visc_hook 

coupling_visc_hook.filename ./inviscid.efn
coupling_visc_hook.prefix   coupling_visc_hook

__END_HASH__

#===========================================================
# ndim nu ndof
nodedata   2  2  3
data cylin.nod.tmp
__END_HASH__

#===========================================================
elemset nsi_tet_les_fm2 4
geometry cartesian2d
npg 4
viscosity <:=2*$Rint/$Re:>
data cylin.con.tmp
__END_HASH__

elemset ns_id 1
__END_HASH__
<:=$nnod:>
__END_ELEMSET__

end_elemsets

#===========================================================
fixa
__INCLUDE__ "cylin.outlet.tmp"
__INCLUDE__ "cylin.skin.tmp"
__END_FIXA__

constraint
__INCLUDE__ "cylin.normal.tmp"
__END_CONSTRAINT__

# Local Variables: $
# mode: shell-script $
# eval: (setq indent-tabs-mode nil) $
# End: $
