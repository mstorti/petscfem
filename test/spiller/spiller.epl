##__INSERT_LICENSE__
## $Id: spiller.epl,v 1.10 2003/03/19 20:17:55 mstorti Exp $ 
<:                              # starts ePerl block
#__TRANSCRIPT__
require "$ENV{'PETSCFEM_DIR'}/test/eperlini.pl";       # Initializes ePerl 
require "$ENV{'PETSCFEM_DIR'}/tools/dx.pl";       # Initializes ePerl 
$case_name = $ENV{'case_name'};
$case_name = 'default' unless defined $case_name;
if (!$re_start && -f 'spiller.axis_nodes.rslt.tmp') {
    unlink 'spiller.axis_nodes.rslt.tmp';
}
$layers = 2;
$C = 0.053547;			# Constants of spiller expr.
$E = 1.85;
$H1 = 66.50;			# vertical position of spiller top position
$L1 = 18;			# Distance from top of spiller to start
				# of flat bottom
$L2 = 50;			# Flat bottom length
$h1 = 4;                        # Water height at top of spiller
$y2 = 65.79;			# restitution height

$ref = 3;
$Ny = 10*$ref;
$Nx = 50*$ref;

$gravity = 9.8;
$uin = sqrt($gravity*$h1);
$fs_relax = 0.3;
$Dt = 0.1;

#__END_TRANSCRIPT__
@vars = qw(C E H1 L1 L2 h1 y2 Ny Nx uin fs_relax Dt);
transcript("", @vars);	# print variables on output and transcript this block
octave_export_vars(">data.m.tmp",@vars);
system "initia=1 octave -qH spiller.m";
$nnod = count_lines("./spiller.nod.tmp");
:>//                            # ends ePerl block

# <:pr('case_name'):>
#===========================================================
global_options
ndim 2

save_file "spiller.state.tmp"
nsave 1

save_file_pattern "spiller.state_%d.tmp"
nsaverot 5
nrec 1
nfile 100000000

initial_state "spiller.ini.tmp"
# initial_state "spiller.state.tmp"
nstep 100
# steady
solver "iisd"
iisd_subpart_auto 2000
preco_type "jacobi"
# print_internal_loop_conv 1
Krylov_dim 200
nnwt 3
alpha 1.0
weak_form 0
<:pr('Dt'):>
rtol 1e-4
atol 1e-10
iisdmat_print_statistics
print_partitioning_statistics
# print_linear_system_and_stop
# verify_jacobian_with_numerical_one 1
# solve_system 0

hook_list ns_dx_hook my_dx_hook \
          dl_generic_hook my_ale_hook

my_ale_hook.filename ./alehook.efn
my_ale_hook.prefix   ale_hook

viscosity 1e-2

# For DX
dx_split_state "1 2 0 1 u 1 1 2 p"
dx_auto_combine
dx_state_all_fields 0
dx_steps 1
# dx_read_state_from_file 1
__END_HASH__

#===========================================================
# ndim nu ndof
nodedata   2  2  3
data spiller.nod.tmp
__END_HASH__

#===========================================================
elemset nsi_tet_les_fm2 4
name viscous_fluid_elemset
geometry cartesian2d
npg 4
data spiller.con.tmp
G_body 0. <:=-$gravity:>
dx 
__END_HASH__

end_elemsets

#===========================================================
fixa
__INCLUDE__ "spiller.fixa_in.tmp"
__INCLUDE__ "spiller.fixa_out.tmp"
__INCLUDE__ "spiller.fixa_bot.tmp"
__INCLUDE__ "spiller.patm.tmp"
__END_FIXA__

#===========================================================
constraint
# __INCLUDE__ "spiller.slip.tmp"
__END_CONSTRAINT__


# Local Variables: $
# mode: shell-script $
# eval: (setq indent-tabs-mode nil) $
# End: $
